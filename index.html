<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="keywords" content="DnD, dangeon and dragons, roleplay, dice, roller, 3D, RPG, wargame"/>
<meta name="description" content="Online 3D dice roller"/>
<title>Major's 3D Dice</title>

<style type="text/css">@import "./includes/login.css";</style>
<!-- Original Source: http://www.teall.info/2014/01/online-3d-dice-roller.html -->
</head>
<body>
    <input type="hidden" id="parent_notation" value="">
    <input type="hidden" id="parent_roll" value="0">

    <div id="waitform"></div>

    <div id="loginform">
        <div style="display: table-cell; vertical-align: middle">
            <div style="margin-left: auto; margin-right: auto; width: 100%">
                <div class="loginform">
                    <h1>Major's 3D Dice Roller</h1>
                    <div class="lform">
                        <div>Player Name</div>
                        <input id="input_user" type="text" maxlength="35" value=""></input>
                        <div>Room Name</div>
                        <input id="input_room" type="text" maxlength="35" value=""></input>
                        <div id="login_message"></div>
                    </div>
                    <br/>
                    <button id="button_join">Join</button>

                    <div class="smalllabel">
                        Created using <a href="http://threejs.org">three.js</a> and <a href="http://cannonjs.org">cannon.js</a>
                        <br>
                        Original source code and idea from <a href="http://www.teall.info/2014/07/multiplayer-3d-dice-roller.html">Tealyatina's Dice roller</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="desk" class="noselect">
        <div id="canvas"></div>
        <div class="center_field">
            <div class="info-field">
                <span id="info_field" style="display: none"></span>
            </div>
        </div>
    </div>
    <div id="selector_div" style="display: none">
        <div class="center_field">
            <div>
                <input type="text" id="set" name="set" value="2d20"></input><br/>
                <button id="throw">Throw</button>
                <button id="clear">Reset</button>
            </div>
            <div id="sethelp">
                choose your dice set by clicking each one,<br/>
                tap and drag on free space of screen or hit throw button to roll
            </div>
            <div id="labelhelp">
                click to continue or tap and drag again
            </div>
        </div>
        <div id="info_div" style="display: none">
            <div class="center_field">
                <span id="label"></span>
            </div>
        </div>
    </div>

    <div id="control_panel_hidden" class="control_panel noselect" style="display:none;visibility:hidden;">
        <div id="control_panel_show" class="control_label">⚙️</div>
    </div>
    <div id="control_panel_shown" class="control_panel noselect">
        <div id="control_panel_hide" class="control_label">⚙️</div>
        <div id="connection_message" class="control_label" style="color:orange">Loading...</div>
        <div id="colorname" class="control_label">Dice Theme: </div>
        <select id="color" name="color">
        </select>
        <select id="texture" name="texture">
        </select>
        <br/>
        <br/>
        <button id="reconnect">Reconnect</button>
        <button id="logout">logout</button>
    </div>

    <div id="log" class="teal-chat" style="display: none"></div>

    <script src="./libs/three.min.js"></script>
    <script src="./libs/cannon.min.js"></script>

    <script type="text/javascript" src="./includes/teal.js"></script>
    <script type="text/javascript" src="./includes/teal.chat.js"></script>
    <script type="text/javascript" src="./includes/colorsets.js"></script>
    <script type="text/javascript" src="./includes/dice.js"></script>
    <script type="text/javascript" src="./includes/login.js"></script>
    <script type="text/javascript" defer="defer">
        
		preload_and_init();

		window.addEventListener("message", receiveMessage, false);

        function receiveMessage(event) {
        	console.log(event);
            if (event.origin !== "https://www.improved-initiative.com" &&
            	event.origin !== "https://files.majorsplace.com" &&
            	event.origin !== "https://rand.majorsplace.com" &&
            	event.origin !== "https://dnd.majorsplace.com") return;

            parent_notation = $t.id('parent_notation');
            parent_roll = $t.id('parent_roll');

            parent_notation.value = event.data;
            parent_roll.value = "1";
            $t.raise(parent_notation, 'change');
            $t.raise(parent_roll, 'change');
        }
    </script>

</body>
</html>
